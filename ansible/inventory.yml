# Ansible inventory generated from Terraform outputs
# Use with: ansible-playbook -i inventory.yml playbook.yml

all:
  vars:
    ansible_user: safalkon
    ansible_ssh_private_key_file: ~/.ssh/id_ed25519
    # Connection via bastion host (if running Ansible locally)
    # ansible_ssh_common_args: '-o ProxyCommand="ssh -W %h:%p -q safalkon@{{ bastion_public_ip }}"'
    # Or run Ansible directly on bastion host

  children:
    bastion:
      hosts:
        diplom-bastion.ru-central1.internal:
          ansible_host: {{ bastion_public_ip }}
          ansible_connection: ssh
          internal_ip: {{ bastion_internal_ip }}

    web_servers:
      hosts:
        # Web servers from instance group will be added dynamically
        # Example: diplom-web-ig-xxxx.ru-central1.internal
      vars:
        nginx_port: 80
        zabbix_server: {{ zabbix_internal_ip }}
        elasticsearch_host: {{ elasticsearch_internal_ip }}

    zabbix_server:
      hosts:
        zabbix.ru-central1.internal:
          ansible_host: {{ zabbix_public_ip }}
          internal_ip: {{ zabbix_internal_ip }}
          zabbix_web_port: 80
          zabbix_server_port: 10051

    elasticsearch:
      hosts:
        elasticsearch.ru-central1.internal:
          ansible_host: {{ elasticsearch_internal_ip }}
          elasticsearch_port: 9200
          elasticsearch_cluster_name: diplom-cluster

    kibana:
      hosts:
        kibana.ru-central1.internal:
          ansible_host: {{ kibana_public_ip }}
          kibana_port: 5601

    monitoring_agents:
      children:
        web_servers

    log_collection:
      children:
        web_servers

    # Group for all hosts
    all_servers:
      children:
        bastion
        web_servers
        zabbix_server
        elasticsearch
        kibana